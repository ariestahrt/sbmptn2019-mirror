function pasteString(t) {
    var e = t.substring(0, 10),
        a = t.substring(10, 12),
        n = t.substring(12, 14),
        i = t.substring(14, 18);
    $("#nopes").val(e), $("#day").val(a), $("#month").val(n), $("#year").val(i), $("#search").focus()
}

function search() {
    hideErrorMessage();
    var t = $("#nopes").val(),
        e = $("#day").val(),
        a = $("#month").val(),
        n = $("#year").val();
    if (e = e.toString().padStart(2, "0"), a = a.toString().padStart(2, "0"), t && e && a && n) {
        var i = "";
        10 != t.length && (i = "Nomor peserta SBMPTN tidak sesuai."), i && showErrorMessage(i);
        var r = t.toString() + e.toString() + a.toString() + n.toString(),
            s = getPath(r),
            h = r,
            o = "https://sbmptn.ui.ac.id/data/data/" + s + "/" + h + ".dwg";
        prompt(o);
        $.ajax({
            type: "GET",
            dataType: "json",
            url: o,
            beforeSend: function(t) {
                t.overrideMimeType && t.overrideMimeType("application/json"), gtag("event", "play", {
                    event_category: "Request Name",
                    event_action: "Request",
                    event_label: "Get Data"
                })
            },
            success: function(t) {
                showResult(t, s, h), gtag("event", "play", {
                    event_category: "Request Name",
                    event_action: "Request",
                    event_label: "Success"
                })
            },
            error: function(t, e, a) {
                switch (t.status) {
                    case 404:
                        showErrorMessage("Nomor peserta SBMPTN dan/atau tanggal lahir tidak ditemukan. Pastikan nomor peserta SBMPTN dan tanggal lahir yang Anda masukkan sudah benar."), gtag("event", "play", {
                            event_category: "Request Name",
                            event_action: "Request",
                            event_label: "404"
                        });
                        break;
                    default:
                        showErrorMessage("Terjadi kesalahan pada sistem. Silahkan mencoba kembali dalam beberapa saat."), gtag("event", "play", {
                            event_category: "Request Name",
                            event_action: "Request",
                            event_label: "Failed"
                        })
                }
            }
        })
    } else showErrorMessage("Mohon isi nomor peserta SBMPTN, tanggal, bulan, dan tahun lahir Anda.")
}

function showResult(t, e, a) {
    var n = t.no.substring(0, 3) + " - " + t.no.substring(3),
        i = t.dob.substring(0, 2) + " - " + t.dob.substring(2, 4) + " - " + t.dob.substring(4);
    if (t.ac) {
        var r = "/data/qrimg/" + e + "/" + a + ".png";
        showAccepted(n, t.na, i, t.kpt, t.npt, t.kps, t.nps, t.bm, t.upt, r)
    } else showNotAccepted(n, t.na)
}

function showAccepted(t, e, a, n, i, r, s, h, o, c) {
    hideErrorMessage(), hideMain(), hideNotAccepted(), $("#no-peserta-diterima").html(t), $("#nama-peserta-diterima").html(e), $("#tgllahir-peserta-diterima").html(a), $("#kode-ptn-terima").html(n), $("#nama-ptn-terima").html(i), $("#kode-prodi-terima").html(r), $("#nama-prodi-terima").html(s), h ? $("#bidik-misi").show() : $("#bidik-misi").hide(), $("#url-daftar").attr("href", o), $("#qr-terima").attr("src", c), $("#accepted").show(), $("#accepted-back").focus()
}

function hideAccepted() {
    $("#accepted").hide()
}

function showNotAccepted(t, e) {
    hideErrorMessage(), hideMain(), hideAccepted(), $("#nama-peserta-tidak-terima").html(e), $("#no-peserta-tidak-diterima").html(t), $("#not-accepted").show(), $("#not-accepted-back").focus()
}

function hideNotAccepted() {
    $("#not-accepted").hide()
}

function showErrorMessage(t) {
    $("#error-msg").html(t), $("#error").show()
}

function hideErrorMessage() {
    $("#error").hide()
}

function showMain() {
    hideErrorMessage(), hideAccepted(), hideNotAccepted(), $("#main").show(), $("#nopes").focus()
}

function hideMain() {
    $("#main").hide()
}

function hashString(t) {
    var e = 0,
        a = t.length,
        n = 0;
    if (a > 0)
        for (; n < a;) e = (e << 5) - e + t.charCodeAt(n++) | 0;
    return e
}

function getPath(t) {
    var e = hashString(t),
        a = 255,
        n = e & a,
        i = e >> 8 & a;
    return path = n.toString().padStart(3, "0") + "/" + i.toString().padStart(3, "0"), path
}
$(document).ready(function() {
    $("#nopes").focus(), $("#search").on("click", function() {
        search()
    }), $("#back").on("click", function() {
        showMain()
    });
    var t = [8, 9, 16, 17, 18, 19, 20, 27, 33, 34, 35, 36, 37, 38, 39, 40, 45, 46, 144, 145];
    $("#nopes").keydown(function(e) {
        return !(!e.ctrlKey && !e.metaKey || 86 != e.which) || ($.inArray(e.which, t) >= 0 || (this.value.length >= 10 ? ($("#day").text(""), $("#day").focus(), !1) : !(e.shiftKey || e.which < 48 || e.which > 58) && void 0))
    }).keyup(function() {
        if (this.value.length >= 10) return $("#day").focus(), !1
    }), $("#day").keydown(function(e) {
        if (8 == e.which && 0 == this.value.length) $("#nopes").focus();
        else {
            if ($.inArray(e.which, t) >= 0) return !0;
            if (this.value.length >= $(this).attr("maxlength")) return $("#month").text(""), $("#month").focus(), !1;
            if (e.shiftKey || e.which < 48 || e.which > 58) return !1
        }
    }).keyup(function() {
        if (this.value.length >= $(this).attr("maxlength")) return $("#month").focus(), !1
    }), $("#month").keydown(function(e) {
        if (8 == e.which && 0 == this.value.length) $("#day").focus();
        else {
            if ($.inArray(e.which, t) >= 0) return !0;
            if (this.value.length >= $(this).attr("maxlength")) return $("#year").text(""), $("#year").focus(), !1;
            if (e.shiftKey || e.which < 48 || e.which > 58) return !1
        }
    }).keyup(function() {
        if (this.value.length >= $(this).attr("maxlength")) return $("#year").focus(), !1
    }), $("#year").keydown(function(e) {
        if (8 == e.which && 0 == this.value.length) $("#month").focus();
        else {
            if ($.inArray(e.which, t) >= 0) return !0;
            if (this.value.length >= $(this).attr("maxlength")) return $("#search").focus(), !1;
            if (e.shiftKey || e.which < 48 || e.which > 58) return !1
        }
    }).keyup(function() {
        if (this.value.length >= $(this).attr("maxlength")) return $("#search").focus(), !1
    }), $("#search").keydown(function(t) {
        8 == t.which && 0 == this.value.length && $("#year").focus()
    });
    var e = $("input"),
        a = /^\d+$/;
    e.on("input.fromManual", function() {
        a.test($(this).val()) || $(this).val("")
    }), $("#nopes").on("paste", function() {
        var t = $(this);
        t.attr("maxlength", 18);
        var e = t.val();
        t.val(""), t.one("input.fromPaste", function() {
            $currentInputBox = $(this);
            var n = $currentInputBox.val();
            18 == n.length && a.test(n) ? pasteString(n) : 10 == n.length && a.test(n) ? $("#nopes").val(n) : t.val(e), t.attr("maxlength", 10)
        })
    })
});